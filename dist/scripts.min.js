class Modal{constructor(e){this.$el=document.querySelector(e),this.$el.style.display="none",this.boundHide=e=>this.hide(e),this.$el.addEventListener("click",this.boundHide),this.$elForm=this.$el.querySelector(".innerModal")}hide(e){e.target===this.$el&&(this.$el.style.display="none")}simpleHide(){this.$el.style.display="none"}show(){this.$el.style.display="flex"}}class Visit{constructor(e){this.purpose="<input name='purpose' placeholder='Цель визита'>",this.desc="<input name='desc' placeholder='Краткое описание визита'>",this.priority=`Срочность визита: <select id='visitPriority' name="visitPriority" placeholder="Срочность визита">
        <option name="priority" value="common">Обычная</option>
        <option name="priority" value="immediate">Приоритетная</option>
        <option name="priority" value="superimmediate">Неотложная</option>
        </select>`,this.name="<input name='name' placeholder='ФИО'>"}}class VisitCardiologist extends Visit{constructor(e){super(e),this.pressure="<input name='pressure' placeholder='Обычное давление'>",this.bmi="<input name='bmi' type='number' placeholder='Индекс массы тела'>",this.illnesses="<input name='illnesses' placeholder='Перенесенные заболевания сердечно-сосудистой системы'>",this.age="<input name='age' type='number' placeholder='Возраст'>"}}class VisitDentist extends Visit{constructor(e){super(e),this.lastVisit="<input name='lastVisit' placeholder='Дата последнего посещения'>"}}class VisitTherapist extends Visit{constructor(e){super(e),this.age="<input name='age' type='number' placeholder='Возраст'>"}}const login=new Modal("#loginWindow");let visit,saveIdCards,saveIdCardsForCreateCard=[],toStr,loginBtn=document.querySelector("#login_btn");loginBtn.addEventListener("click",()=>login.show());const logInField=document.querySelector("input[name='login']"),passwordField=document.querySelector("input[name='password']");function createBtnVisit(e){const t=document.createElement("button");var i;t.innerHTML="Создать визит",t.classList.add("nav__btn"),t.addEventListener("click",e),i=t.innerHTML,localStorage.setItem("hiDen",i),document.querySelector("nav").append(t)}document.querySelector("#log_in").addEventListener("click",async function(){fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:logInField.value,password:passwordField.value})}).then(e=>e.text()).then(e=>36!==e.length||"-"!==e[8]||"-"!==e[13]||"-"!==e[18]||"-"!==e[23]?alert("Неверный логин или пароль"):(localStorage.setItem("token",e),login.simpleHide(),document.querySelector("input[name='login']").value=document.querySelector("input[name='password']").value="",document.querySelector("#login_btn").style.display="none",createBtnVisit(functionForListener),void renderCard()))});let functionForListener=async function(){visit=new Modal("#visitWindow");const i=new VisitCardiologist,e=new VisitDentist,t=new VisitTherapist;function n(e){const t=document.querySelector("#visitWindow");for(key in t.querySelector(".selectVisitDetails").innerHTML="",i)t.querySelector(".selectVisitDetails").innerHTML+=e[key]}n(i),document.querySelector("#selectVisit").addEventListener("click",()=>{switch(document.querySelector("#selectVisit").value){case"Визит к кардиологу":n(i);break;case"Визит к стоматологу":n(e);break;case"Визит к терапевту":n(t)}}),visit.show()};function createDivCards(){let e=document.createElement("div");e.classList.add("wrapper-cards"),e.id=saveIdCards||getIdCard;let t=document.getElementById("new_cards");t.append(e);var i=document.querySelectorAll(".wrapper-cards");const n=i[i.length-1];n.insertAdjacentHTML("beforeend",'<span class="closeBtn" >&times;</span>')}function renderCard(){document.querySelector("#createVisit").addEventListener("click",async function(){let e={};for(key of document.querySelector(".selectVisitDetails").children)e[key.name]=key.value;fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{var t;saveIdCardsForCreateCard.push(e.id),saveIdCards=e.id,toStr=saveIdCards.toString(),null==localStorage.getItem("idCards")?localStorage.setItem("idCards",saveIdCards):(t=localStorage.getItem("idCards"),t+=","+saveIdCards,localStorage.setItem("idCards",t)),finishCreateCard(e),visit.simpleHide()})})}function finishCreateCard(e){for(var t in createDivCards(),clickOnCloseBtn(localStorage.getItem("idCards")),e)if(0!==e[t].length){var i=document.querySelectorAll(".wrapper-cards");const n=i[i.length-1];n.insertAdjacentHTML("beforeend",`<li class="text-in-cards"> ${t+" :"+e[t]+"\n"}</li>`)}}let getIdCard;function getAllCard(e){let t=localStorage.getItem(e),i=t.split(",");i.forEach(e=>{Number(e),fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>e.json()).then(e=>{getIdCard=e.id,finishCreateCard(e)})})}let clearBtn=document.getElementsByClassName("closeBtn");function clickOnCloseBtn(){for(var e of clearBtn)e.addEventListener("click",async e=>{let t=e.target.parentElement.id;e=Number(t);let i=document.getElementById(t),n=localStorage.getItem("idCards"),a=n.split(","),r=[];a.forEach(e=>{t!==e&&(r.push(e),e=r.toString(),localStorage.setItem("idCards",e))}),fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>{i.remove()})})}function reloadPage(){0!==localStorage.length&&localStorage.getItem("hiDen").length&&(loginBtn.remove(),createBtnVisit(functionForListener),renderCard(),getAllCard("idCards"))}reloadPage();